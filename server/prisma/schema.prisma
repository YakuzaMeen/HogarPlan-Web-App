// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Modelo de Usuario
model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  password  String
  name      String?
  role      String    @default("USER")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relaciones: Un usuario crea clientes, inmuebles y simulaciones
  clientes      Cliente[]
  inmuebles     Inmueble[]
  simulaciones  Simulacion[]
}

// Modelo de Clientes
model Cliente {
  id              Int      @id @default(autoincrement())
  nombres         String
  apellidos       String?
  tipoDocumento   String?
  numeroDocumento String?
  email           String   @unique
  telefono        String?
  direccion       String?
  ingresoMensual  Decimal? @db.Decimal(12, 2)

  // Relación con User
  creadoPorId     Int
  creadoPor       User     @relation(fields: [creadoPorId], references: [id])

  // Relación con Simulaciones
  simulaciones    Simulacion[]

  fechaCreacion   DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// Modelo de Inmuebles
model Inmueble {
  id                  Int      @id @default(autoincrement())

  nombreProyecto      String
  tipoInmueble        String?
  direccion           String
  valor               Decimal  @db.Decimal(15, 2)
  moneda              String?  // "Dólares", "Soles", etc.
  areaMetrosCuadrados Float?


  descripcion         String?  @db.Text
  habitaciones        Int?
  banos               Int?
  disponible          Boolean  @default(true)

  // Relación con User
  creadoPorId     Int
  creadoPor       User     @relation(fields: [creadoPorId], references: [id])

  // Relación con Simulaciones
  simulaciones    Simulacion[]

  fechaCreacion   DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// Modelo de Simulaciones Completo
model Simulacion {
  id                      Int      @id @default(autoincrement())

  // Relaciones
  clienteId               Int
  cliente                 Cliente  @relation(fields: [clienteId], references: [id])
  inmuebleId              Int
  inmueble                Inmueble @relation(fields: [inmuebleId], references: [id])
  creadoPorId             Int
  creadoPor               User     @relation(fields: [creadoPorId], references: [id])

  // Datos del Inmueble en el momento de la simulación (Snapshot)
  valorInmueble           Decimal  @db.Decimal(15, 2)
  moneda                  String?

  // Datos del Préstamo
  montoPrestamo           Decimal  @db.Decimal(15, 2)
  plazoAnios              Int      // Cambiado de plazoMeses a plazoAnios según tu código
  tipoTasa                String   // "Nominal" o "Efectiva"
  tasaInteresAnual        Float
  capitalizacion          String?  // "Mensual", "Diaria", etc.

  // Seguros y Bonos
  seguroDesgravamen       Float
  seguroInmueble          Float
  periodoGraciaTotalMeses Int?     @default(0)
  periodoGraciaParcialMeses Int?   @default(0)
  aplicaBonoTechoPropio   Boolean  @default(false)
  valorBono               Decimal? @default(0) @db.Decimal(12, 2)

  // Resultados Calculados
  cuotaMensual            Decimal? @db.Decimal(12, 2)
  tcea                    Float?
  van                     Float?
  tir                     Float?

  // Plan de Pagos (Guardado como JSON porque es una lista compleja)
  planDePagos             Json?

  fechaCreacion           DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

// Modelo de Notificaciones
model Notification {
  id      Int      @id @default(autoincrement())
  titulo  String
  mensaje String   @db.Text
  leido   Boolean  @default(false)
  fecha   DateTime @default(now())
}